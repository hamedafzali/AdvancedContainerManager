import{j as t}from"./charts-aae23e34.js";import{r as n}from"./vendor-280e31ee.js";import{a as y}from"./api-f33f6490.js";import{c as D,u as _,X as ee,T as te}from"./index-e694318b.js";import{C as se}from"./copy-14abb27d.js";import{D as ne}from"./download-fe859b1d.js";import"./utils-9456a7ed.js";const re=D("Command",[["path",{d:"M15 6v12a3 3 0 1 0 3-3H6a3 3 0 1 0 3 3V6a3 3 0 1 0-3 3h12a3 3 0 1 0-3-3",key:"11bfej"}]]),ae=D("Maximize2",[["polyline",{points:"15 3 21 3 21 9",key:"mznyad"}],["polyline",{points:"9 21 3 21 3 15",key:"1avn1i"}],["line",{x1:"21",x2:"14",y1:"3",y2:"10",key:"ota7mn"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]),oe=D("Minimize2",[["polyline",{points:"4 14 10 14 10 20",key:"11kfnr"}],["polyline",{points:"20 10 14 10 14 4",key:"rlmsce"}],["line",{x1:"14",x2:"21",y1:"10",y2:"3",key:"o5lafz"}],["line",{x1:"3",x2:"10",y1:"21",y2:"14",key:"1atl0r"}]]);function fe(){var O;const{containerId:U}=_(),[T,H]=n.useState([]),[o,$]=n.useState(U||""),[b,L]=n.useState([]),[d,i]=n.useState(""),[a,F]=n.useState(!1),[x,K]=n.useState(!1);n.useState(!1);const[g,P]=n.useState([]),[w,k]=n.useState(-1),[A,B]=n.useState(!0),[I,j]=n.useState(null),[ie,J]=n.useState([]),[v,z]=n.useState(""),[m,V]=n.useState([]),[C,c]=n.useState(!1),[p,l]=n.useState(0),N=n.useRef(null),S=n.useRef(null),W=async()=>{try{const e=await fetch(y("/api/containers"));if(!e.ok)throw new Error("Failed to fetch containers");const u=(await e.json()).data.map(f=>({id:f.id,name:f.name,status:f.status,image:f.image}));H(u),!o&&u.length>0&&$(u[0].id)}catch(e){j(e instanceof Error?e.message:"Failed to fetch containers")}finally{B(!1)}},E=async()=>{try{const e=await fetch(y("/api/terminal/sessions"));if(!e.ok)throw new Error("Failed to fetch sessions");const s=await e.json();J(s.data||[])}catch(e){console.error("Failed to fetch sessions:",e)}},R=async e=>{try{const s=await fetch(y(`/api/terminal/${e}/session`),{method:"POST"});if(!s.ok)throw new Error("Failed to create terminal session");const r=await s.json();z(r.data.id),F(!0),h("success",`Connected to container ${e}`),await E()}catch(s){j(s instanceof Error?s.message:"Failed to create terminal session")}},X=async()=>{if(v)try{if(!(await fetch(y(`/api/terminal/sessions/${v}`),{method:"DELETE"})).ok)throw new Error("Failed to close terminal session");F(!1),z(""),h("info","Terminal session closed"),await E()}catch(e){j(e instanceof Error?e.message:"Failed to close terminal session")}},q=async e=>{if(!(!a||!v)){h("input",`$ ${e}`),i("");try{const s=await fetch(y(`/api/terminal/sessions/${v}/execute`),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({command:e})});if(!s.ok)throw new Error("Failed to execute command");const r=await s.json();r.output&&h("output",r.output),r.error&&h("error",r.error)}catch(s){h("error",s instanceof Error?s.message:"Failed to execute command")}}},h=(e,s)=>{L(r=>[...r,{id:Date.now().toString(),type:e,content:s,timestamp:new Date().toISOString()}])},G=["ls","cd","pwd","cat","grep","find","ps","kill","top","df","du","free","uname","whoami","exit","clear","help","docker ps","docker logs","docker exec","docker stop","docker start"],M=n.useCallback(e=>e?G.filter(s=>s.startsWith(e.toLowerCase())):[],[]),Q=e=>{if(a)switch(e.key){case"Enter":e.preventDefault(),d.trim()&&(q(d.trim()),P(s=>[...s,d.trim()]),k(-1),c(!1),l(0));break;case"ArrowUp":e.preventDefault(),C&&p>0?(l(s=>s-1),i(m[p-1])):w<g.length-1&&(k(s=>s+1),i(g[g.length-1-w]),c(!1));break;case"ArrowDown":e.preventDefault(),C&&p<m.length-1?(l(s=>s+1),i(m[p+1])):w>0&&(k(s=>s-1),i(g[g.length-1-w]),c(!1));break;case"Tab":e.preventDefault(),m.length>0&&(i(m[0]),c(!1),l(0));break;case"Escape":e.preventDefault(),c(!1),l(0);break;case"c":e.ctrlKey&&(e.preventDefault(),i(""),c(!1),l(0));break;case"l":e.ctrlKey&&(e.preventDefault(),L([]));break}};n.useEffect(()=>{const e=M(d);V(e),c(e.length>0&&d.length>0),l(0)},[d,M]),n.useEffect(()=>{N.current&&(N.current.scrollTop=N.current.scrollHeight)},[b]),n.useEffect(()=>{a&&S.current&&S.current.focus()},[a]),n.useEffect(()=>{W(),E()},[]),n.useEffect(()=>{o&&!a&&R(o)},[o]);const Y=()=>{const e=b.map(s=>s.content).join(`
`);navigator.clipboard.writeText(e)},Z=()=>{const e=b.map(f=>f.content).join(`
`),s=new Blob([e],{type:"text/plain"}),r=URL.createObjectURL(s),u=document.createElement("a");u.href=r,u.download=`terminal-${o}-${new Date().toISOString()}.txt`,u.click(),URL.revokeObjectURL(r)};return A?t.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-8 h-8 border-4 border-green-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"}),t.jsx("h2",{className:"text-xl font-light text-white mb-2",children:"Loading Terminal..."}),t.jsx("p",{className:"text-gray-400",children:"Fetching containers and connecting to Docker"})]})}):I?t.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center",children:t.jsxs("div",{className:"text-center",children:[t.jsx("div",{className:"w-16 h-16 bg-red-900 rounded-full flex items-center justify-center mx-auto mb-4",children:t.jsx(ee,{className:"w-8 h-8 text-red-400"})}),t.jsx("h2",{className:"text-xl font-light text-white mb-2",children:"Terminal Error"}),t.jsx("p",{className:"text-gray-400 mb-4",children:I}),t.jsx("button",{onClick:()=>j(null),className:"px-4 py-2 bg-gray-700 hover:bg-gray-600 text-white rounded-lg transition-colors duration-200",children:"Retry"})]})}):t.jsx("div",{className:`min-h-screen bg-gray-900 ${x?"":"p-4"}`,children:t.jsxs("div",{className:`bg-gray-800 rounded-lg shadow-2xl border border-gray-700 ${x?"h-screen":"h-96"}`,children:[t.jsxs("div",{className:"bg-gray-900 border-b border-gray-700 px-4 py-2 flex items-center justify-between",children:[t.jsxs("div",{className:"flex items-center space-x-4",children:[t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx(te,{className:"w-4 h-4 text-green-400"}),t.jsxs("span",{className:"text-sm font-medium text-white",children:["Terminal:"," ",o?(O=T.find(e=>e.id===o))==null?void 0:O.name:"No container selected"]}),t.jsx("div",{className:`w-2 h-2 rounded-full ${a?"bg-green-500":"bg-gray-600"}`})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsxs("select",{value:o,onChange:e=>$(e.target.value),className:"bg-gray-800 text-white text-sm px-3 py-1 rounded border border-gray-600 focus:outline-none focus:ring-2 focus:ring-blue-500",children:[t.jsx("option",{value:"",children:"Select container..."}),T.filter(e=>e.status==="running").map(e=>t.jsxs("option",{value:e.id,children:[e.name," (",e.image,")"]},e.id))]}),o&&t.jsx(t.Fragment,{children:t.jsx("button",{onClick:a?X:()=>R(o),className:`px-3 py-1 text-sm rounded ${a?"bg-red-600 hover:bg-red-700":"bg-green-600 hover:bg-green-700"} text-white transition-colors duration-200`,children:a?"Disconnect":"Connect"})})]})]}),t.jsxs("div",{className:"flex items-center space-x-2",children:[t.jsx("button",{onClick:Y,className:"p-1 hover:bg-gray-700 rounded text-gray-300 hover:text-white transition-colors duration-200",title:"Copy output",children:t.jsx(se,{className:"w-4 h-4"})}),t.jsx("button",{onClick:Z,className:"p-1 hover:bg-gray-700 rounded text-gray-300 hover:text-white transition-colors duration-200",title:"Download output",children:t.jsx(ne,{className:"w-4 h-4"})}),t.jsx("button",{onClick:()=>K(!x),className:"p-1 hover:bg-gray-700 rounded text-gray-300 hover:text-white transition-colors duration-200",title:x?"Minimize":"Maximize",children:x?t.jsx(oe,{className:"w-4 h-4"}):t.jsx(ae,{className:"w-4 h-4"})})]})]}),t.jsxs("div",{ref:N,className:"bg-black p-4 font-mono text-sm text-green-400 overflow-auto",style:{height:x?"calc(100vh - 60px)":"calc(384px - 60px)"},children:[b.map(e=>t.jsxs("div",{className:"flex",children:[t.jsx("span",{className:"text-gray-500 mr-2 text-xs",children:new Date(e.timestamp).toLocaleTimeString()}),t.jsx("span",{className:e.type==="error"?"text-red-400":e.type==="success"?"text-green-400":e.type==="input"?"text-blue-400":"text-gray-300",children:e.content})]},e.id)),t.jsxs("div",{className:"flex items-center",children:[t.jsx("span",{className:"text-gray-500 mr-2 text-xs",children:new Date().toLocaleTimeString()}),t.jsx("span",{className:"text-blue-400",children:"$"}),t.jsx("input",{ref:S,type:"text",value:d,onChange:e=>i(e.target.value),onKeyDown:Q,className:"flex-1 bg-transparent outline-none text-green-400",placeholder:a?"Enter command...":"Connect to a container first",disabled:!a})]}),C&&m.length>0&&t.jsx("div",{className:"absolute bottom-full left-0 mb-2 bg-gray-800 border border-gray-600 rounded-lg shadow-xl max-h-48 overflow-y-auto",children:m.map((e,s)=>t.jsx("div",{className:`px-3 py-2 cursor-pointer text-sm ${s===p?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-700"}`,onClick:()=>{var r;i(e),c(!1),l(0),(r=S.current)==null||r.focus()},children:t.jsxs("div",{className:"flex items-center",children:[t.jsx(re,{className:"w-3 h-3 mr-2 text-gray-400"}),e]})},e))})]})]})})}export{fe as default};
//# sourceMappingURL=Terminal-4a93cf30.js.map
